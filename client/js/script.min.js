$(document).ready(function(){sessionStorage.clear();var e="https://artful-nz.herokuapp.com";function t(e){document.getElementById("memberName").innerHTML="<b>"+e+"</b>"}function o(){let t=sessionStorage.getItem("memberId");t&&$.ajax({url:`${e}/myPortfolios/${t}`,type:"GET",success:function(e){"No portfolio by this user found"!==e?function(e){document.getElementById("myProjectCards").innerHTML=e.map(e=>`\n    <div class="card portfolioCard border-bottom">\n      <div style="background-image:url(${e.image})" class="portfolioPage-image"></div>\n      <h5 class="portfolioPage-cardTitle card-text mb-3">${e.title}</h5>\n      <div id="portfolioCard__buttonWrapper${e._id}" class="row mb-2">\n        <div class="col-sm-12 col-md-4 col-lg-4">\n          <div class="button viewMoreButton btn-font mb-3" id="${e._id}">View</div>\n        </div>\n        <div class="col-sm-12 col-md-4 col-lg-4">\n          <div class="editButton btn-dark btn-font radius py-2 px-2 mb-3" id="edit${e._id}">Edit</div>\n        </div>\n        <div class="col-sm-12 col-md-4 col-lg-4">\n          <div class="deleteButton btn-red radius px-3 py-2 mb-3 btn-font float-lg-right" id="delete${e._id}">Delete</div>\n        </div>\n      </div>\n    </div>\n    `).join(" ");let t=document.getElementsByClassName("viewMoreButton");for(let e=0;e<t.length;e++)t[e].addEventListener("click",s);let o=document.getElementsByClassName("editButton");for(let e=0;e<o.length;e++)o[e].addEventListener("click",a);let n=document.getElementsByClassName("deleteButton");for(let e=0;e<n.length;e++)n[e].addEventListener("click",l)}(e):document.getElementById("myProjectCards").innerHTML='\n        <div class="noPortfolio text-center">You have not upload any project yet!</div>\n        '},error:function(e){console.log(e)}})}function n(e){let t=e.about?e.about:"",o=e.website?e.website:"",n=e.location?e.location:"";document.getElementById("memberAccount").innerHTML=`\n  <div class="flexContainer-flexStart mb-1">\n    <strong class="userInfoField">Username:</strong>\n    <div>${e.username}</div>\n  </div>\n  <div class="flexContainer-flexStart mb-1">\n    <strong class="userInfoField">Email:</strong>\n    <div>${e.email}</div>\n  </div>\n  <div class="flexContainer-flexStart mb-1">\n    <strong class="userInfoField">About:</strong>\n    <div>${t}</div>\n  </div>\n  <div class="flexContainer-flexStart mb-1">\n    <strong class="userInfoField">Location:</strong>\n    <div>${n}</div>\n  </div>\n  <div class="flexContainer-flexStart mb-1">\n    <strong class="userInfoField">Website:</strong>\n    <a>${o}</a>\n  </div>\n  `}function i(t){t.preventDefault();let o=sessionStorage.getItem("memberId"),i=$("#editUserForm__username").val(),a=$("#editUserForm__email").val(),r=$("#editUserForm__description").val(),s=$("#editUserForm__location").val(),l=$("#editUserForm__website").val();$.ajax({url:`${e}/updateMember/${o}`,type:"PATCH",data:{username:i,email:a,about:r,location:s,website:l},success:function(e){n(e),$("#updateMemberBtn").show()},error:function(e){console.log(e)}})}function a(t){const o=t.target.id.slice(4);sessionStorage.setItem("projectOnEdit",o),$.ajax({url:`${e}/findProject/${o}`,type:"GET",dataType:"json",success:function(e){$("#updatePortfolioTitle").val(e.title),$("#updatePortfolioDescription").val(e.description),$("#updatePortfolioImage").val(e.image),$("#updatePortfolioCategory").val(e.category),$("#updatePortfolioPrice").val(e.price),$("#projectPage").hide(),$("#updatePortfolioPage").show()},error:function(e){console.log(e)}})}function r(e){document.getElementById("artsDeck").innerHTML=e.map(e=>`<div class="col-sm-12 col-md-6 col-lg-4 my-xs-1 my-sm-1 my-md-3 my-lg-3">\n      <div class="card card-border rounded-0 mb-4">\n\n      <img src="${e.image}" alt="Avatar" class="card-img-top radius">\n\n      <div class="card-body artcard-body mx-1 my-1">\n      <div class="artcard-columnwrap">\n      <h4 class="card-title mb-3">${e.title}</h4>\n      <h5 class="card-title artcard-price">&dollar;${e.price}</h5>\n      </div>\n      <p class="card-title"><b>${e.authorInfo.username}, ${e.authorInfo.location}</b></p>\n      <p class="mb-3 text-truncate">${e.description}</p>\n      <a href="${e.authorInfo.website}" class="card-link artcard-link">Artist Website</a>\n      <div class="artcard-columnwrap mt-4">\n      <p class="card-title h5-cyan">${e.category}</p>\n      <div class="button viewMoreButton btn-font" id="${e._id}">View</div>\n      </div>\n      </div>\n\n      </div>\n      </div>`).join(" ");let t=document.getElementsByClassName("viewMoreButton");for(let e=0;e<t.length;e++)t[e].addEventListener("click",s)}function s(t){let o=t.target.id;$.ajax({url:`${e}/portfolioWithAuthor/${o}`,type:"GET",dataType:"json",success:function(e){!function(e){let t,o,n=sessionStorage.getItem("username");t=e.comments.map(function(e){return n&&e.postByUsername===n?`\n          <div class="col-sm-12 col-lg-12 col-md-10">\n            <div class="comment-container comment-right mb-3">\n                <div class="comment-info">\n                <strong class="mr-1">You</strong>\n                <p>on ${g(e.posted)}</p>\n              </div>\n              <p><b>${e.text}</b></p>\n            </div>\n          </div>\n        `:e.postByUsername!==n?`\n          <div class="col-sm-12 col-lg-12 col-md-10">\n            <div class="comment-container comment-left mb-3">\n              <div class="comment-info">\n                <strong class="mr-1">${e.postByUsername}</strong>\n                <p>on ${g(e.posted)}</p>\n              </div>\n              <p>${e.text}</p>\n            </div>\n          </div>\n        `:void 0}).join(" "),o=n?'\n      <div class="col-12 col-sm-12 col-lg-10 col-md-10 mx-auto">\n        <label for="viewMorePage-postComment" class="nav-font">Comment:</label>\n        <textarea id="viewMorePage-postComment" class="col-12 col-sm-12 col-lg-10 col-md-10" rows="4" cols="100"></textarea>\n        <div class="col-12 col-sm-12 col-lg-11 col-md-11">\n            <div id="viewMorePage-postCommentButton" class="button btn-font bg-dark float-right mt-2 mb-5">Submit</div>\n        </div>\n      </div>\n    ':'\n      <div class="text-center mb-5">Please log in to add comment</div>\n    ',document.getElementById("viewMorePage").innerHTML=`\n    <div id="viewMorePage-artInfo">\n    <h5 class="h3">${e.title}</h5>\n    <div class="viewMore-photoBackground">\n    <img src="${e.image}" class="viewMore-mainPhoto" alt="${e.title} photo">\n    </div>\n    <div class="flexContainer-row mt-3 mb-3">\n    <h5 class="h4">${e.authorInfo.username}</h5>\n    <h5 class="card-title h4 artcard-price">&dollar;${e.price}</h5>\n    </div>\n    <p>${e.description}</p>\n    <strong class="mb-5">Location: ${e.authorInfo.location}</strong>\n    <br/>\n    <a href="${e.authorInfo.website}" class="artcard-link">${e.authorInfo.website}</a>\n    <div class="artcard-columnwrap mt-5 viewMore-endBoarder">\n    <p class="card-title h5-cyan">${e.category}</p>\n    <div class="bg-info text-white radius py-2 px-3 btn-font" id="${e._id}">Buy Now</div>\n    </div>\n    <button id="backToLanding" type="button" class="btn btn-dark mt-3 mb-5 btn-font radius">Back</button>\n    </div>\n    <div class="bg-light pt-5">\n    <div class="row mx-auto">\n        <div class="col-12 mb-5">\n          <h5 class="text-center">Questions About This Artwork</h5>\n        </div>\n        <div class="col-8 mx-auto">\n\n          <div id="viewMorePage-comments" class="mb-5">\n            ${t}\n          </div>\n\n        </div>\n      </div>\n    \n    <div class="row mx-auto">\n      <div class="col-12 mb-4 mt-3">\n        <h5 class="text-center">Ask the Artist a Question</h5>\n      </div>\n      <div id="viewMorePage-addCommentWrapper" class="row mx-auto">\n        ${o}\n      </div>\n    </div>\n    </div>\n    `,$("html, body").animate({scrollTop:0},"fast"),document.getElementById("backToLanding").addEventListener("click",function(){$("#viewMorePage").hide(),$("#landingPage").show(),sessionStorage.removeItem("currentPortfolio")}),document.getElementById("viewMorePage").contains(document.getElementById("viewMorePage-postCommentButton"))&&document.getElementById("viewMorePage-postCommentButton").addEventListener("click",m)}(e[0]),sessionStorage.setItem("currentPortfolio",e[0]._id),$("#viewMorePage").show(),$("#projectPage").hide(),$("#landingPage").hide(),0!==e[0].comments.length||(document.getElementById("viewMorePage-comments").innerHTML='\n          <div id="noCommentNote" class="text-center">There has not been any question about this artwork</div>\n          ')},error:function(e){console.log("Error: "+e)}})}function l(e){let t=e.target.id.slice(6);sessionStorage.setItem("projectOnDelete",t);let o=`portfolioCard__buttonWrapper${t}`;document.getElementById(o).innerHTML='\n        <div class="mx-auto">\n          <p class="text-center">Are you sure you want to delete this project?</p>\n          <button id="abortDeleteProject" class="btn btn-danger btn-font back-portfolio radius float-left">Cancel</button>\n          <button id="confirmDeleteProject" type="button" class="btn btn-dark btn-font float-right radius">Delete</button>\n        </div>\n    ',document.getElementById("confirmDeleteProject").addEventListener("click",d),document.getElementById("abortDeleteProject").addEventListener("click",c)}function d(){let t=sessionStorage.getItem("projectOnDelete");$.ajax({url:`${e}/deletePortfolio/${t}`,type:"DELETE",success:function(e){sessionStorage.removeItem("projectOnDelete"),o()},error:function(e){console.log(e)}})}function c(e){let t=sessionStorage.getItem("projectOnDelete"),o=`portfolioCard__buttonWrapper${t}`;document.getElementById(o).innerHTML=`\n      <div class="col-sm-12 col-md-4 col-lg-4">\n        <div class="button viewMoreButton btn-font mb-3" id="${t}">View</div>\n      </div>\n      <div class="col-sm-12 col-md-4 col-lg-4">\n        <div class="editButton btn-dark btn-font radius py-2 px-2 mb-3" id="edit${t}">Edit</div>\n      </div>\n      <div class="col-sm-12 col-md-4 col-lg-4">\n        <div class="deleteButton btn-red radius px-3 py-2 mb-3 btn-font float-lg-right" id="delete${t}">Delete</div>\n      </div>\n    `;let n=document.getElementsByClassName("viewMoreButton");for(let e=0;e<n.length;e++)n[e].addEventListener("click",s);let i=document.getElementsByClassName("editButton");for(let e=0;e<i.length;e++)i[e].addEventListener("click",a);let r=document.getElementsByClassName("deleteButton");for(let e=0;e<r.length;e++)r[e].addEventListener("click",l)}function m(){let t=$("textarea#viewMorePage-postComment").val(),o=Date.now(),n=sessionStorage.getItem("currentPortfolio"),i=sessionStorage.getItem("memberId"),a=sessionStorage.getItem("username");$.ajax({url:`${e}/addComment`,type:"POST",data:{portfolioID:n,postByID:i,postByUsername:a,postDate:o,content:t},success:function(e){$("textarea#viewMorePage-postComment").val(""),function(e){let t=`\n\n    <div class="col-sm-12 col-lg-12 col-md-10">\n        <div class="comment-container comment-right mb-3">\n        <div class="comment-info">\n        <strong class="mr-1">You</strong>\n        <p>on ${g(e.posted)}</p>\n        </div>\n        <p><b>${e.text}</b></p>\n        </div>\n    </div>\n    `,o=document.getElementById("viewMorePage-comments"),n=document.getElementById("noCommentNote");o.contains(n)&&n.remove();document.getElementById("viewMorePage-comments").innerHTML+=t}(e)},error:function(e){console.log(e)}})}function g(e){let t=new Date(e);return`${t.getDate()}/${t.getMonth()}/${t.getFullYear()} at ${t.getHours()}:${(t.getMinutes()<10?"0":"")+t.getMinutes()}`}$.ajax({url:`${e}/portfoliosAndAuthors`,type:"GET",dataType:"json",success:function(e){r(e)},error:function(e){console.log("Error: "+e)}}),sessionStorage.username?($("#logoutBtn").show(),$("#myPortfolioBtn").show(),$("#loginBtn").hide(),$("#signUpBtn").hide(),t(sessionStorage.username),$("#landingPage").show(),$("#viewMorePage").hide(),$("#loginPage").hide(),$("#signUpPage").hide(),$("#projectPage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolioPage").hide()):($("#logoutBtn").hide(),$("#myPortfolioBtn").hide(),$("#loginBtn").show(),$("#signUpBtn").show(),$("#landingPage").show(),$("#viewMorePage").hide(),$("#loginPage").hide(),$("#signUpPage").hide(),$("#projectPage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolioPage").hide()),$("#homeBtn").click(function(){$("#landingPage").show(),$("#viewMorePage").hide(),$("#loginPage").hide(),$("#signUpPage").hide(),$("#projectPage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolioPage").hide()}),$("#loginBtn").click(function(){$("#loginPage").show(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#signUpPage").hide(),$("#projectPage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolioPage").hide()}),$("#signUpBtn").click(function(){$("#signUpPage").show(),$("#projectPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolioPage").hide()}),$("#myPortfolioBtn").click(function(){o(),function(){let t=sessionStorage.getItem("memberId");if(!t)return;$.ajax({url:`${e}/myAccountInfo/${t}`,type:"GET",dataType:"json",success:function(e){n(e)},error:function(e){console.log(e)}})}(),$("#projectPage").show(),$("#signUpPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#uploadPortfolioPage").hide()}),$("#addPortfolio").click(function(){$("#uploadPortfolioPage").show(),$("#projectPage").hide(),$("#signUpPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#updatePortfolioPage").hide()}),$(".back-portfolio").click(function(){$("#projectPage").show(),$("#uploadPortfolioPage").hide(),$("#signUpPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#updatePortfolioPage").hide()}),$("#updateProject").click(function(){$("#uploadPortfolioPage").hide(),$("#projectPage").hide(),$("#signUpPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#updatePortfolioPage").show()}),$("#deleteProject").click(function(){$("#uploadPortfolioPage").hide(),$("#projectPage").hide(),$("#signUpPage").hide(),$("#loginPage").hide(),$("#landingPage").hide(),$("#viewMorePage").hide(),$("#updatePortfolioPage").hide()}),$("#logoutBtn").click(function(){sessionStorage.clear(),$("#landingPage").show(),$("#loginPage").hide(),$("#signUpPage").hide(),$("#projectPage").hide(),$("#uploadPortfolioPage").hide(),$("#updatePortfolio").hide(),location.reload("#loginForm")}),$("#viewMembersBtn").click(function(){$.ajax({url:`${e}/allMembers`,type:"GET",dataType:"json",success:function(e){$("#membersCards").empty(),document.getElementById("membersCards").innerHTML+='<h2 class="pt-5 pb-4">All Members</h2>';for(let t=0;t<e.length;t++)document.getElementById("membersCards").innerHTML+=`<div class="col mt-3">\n        <h4> ${e[t].username}</h4>\n        </div>`},error:function(){}})}),$("#registerForm").submit(function(){event.preventDefault();let t=$("#registerUsername").val(),o=$("#registerEmail").val(),n=$("#registerPassword").val();$.ajax({url:`${e}/registerMember`,type:"POST",data:{username:t,email:o,password:n},success:function(e){"Members name is already taken. Please choose another name"!==e?(alert("Your account has been created, please login to activate your account"),$("#loginBtn").show(),$("#registerBtn").hide(),$("#loginPage").show(),$("#signUpPage").hide()):(alert("Username already taken. Please try another one"),$("#registerUsername").val(""),$("#registerEmail").val(""),$("#registerPassword").val(""))},error:function(){console.log("error: cannot call api")}})}),$("#loginForm").submit(function(){event.preventDefault();let o=$("#inputUsernameLogin").val(),n=$("#inputPasswordLogin").val();$.ajax({url:`${e}/loginMember`,type:"POST",data:{username:o,password:n},success:function(e){" "===e?alert("Please fill in all input fields"):"Member not found. Please register"===e?alert("Register please"):"Not Authorized"===e?alert("Incorrect Password"):(sessionStorage.setItem("memberId",e._id),sessionStorage.setItem("username",e.username),sessionStorage.setItem("email",e.email),sessionStorage.setItem("location",e.location),sessionStorage.setItem("website",e.website),sessionStorage.setItem("about",e.about),t(o),$("#logoutBtn").show(),$("#myPortfolioBtn").show(),$("#loginBtn").hide(),$("#signUpBtn").hide(),$("#landingPage").show(),$("#loginPage").hide(),$("html, body").animate({scrollTop:0},"fast"))},error:function(){}})}),$("#addPortfolioForm").submit(function(){if(event.preventDefault(),!sessionStorage.memberId)return void alert("401, permission denied");let t=$("#addPortfolioTitle").val(),n=$("#addPortfolioDescription").val(),i=$("#addPortfolioImage").val(),a=$("#addPortfolioCategory").val(),r=$("#addPortfolioPrice").val(),s=sessionStorage.getItem("memberId");""==t||""==n||""==i||""==a||""==r?alert("Please enter all details"):$.ajax({url:`${e}/addPortfolio`,type:"POST",data:{title:t,description:n,image:i,category:a,price:r,memberId:s},success:function(e){"Artwork already added"!==e?alert("Added the portfolio"):alert("Title taken already, please try another one"),$("#addPortfolioTitle").val(),$("#addPortfolioDescription").val(),$("#addPortfolioImage").val(),$("#addPortfolioCategory").val(),$("#addPortfolioPrice").val(),$("#addPortfolioMemberId").val(),$("#addPortfolioForm").trigger("reset"),$("#uploadPortfolioPage").hide(),o(),$("#projectPage").show(),$("html, body").animate({scrollTop:50},"fast")},error:function(){}})}),$("#updatePortfolioForm").submit(function(){event.preventDefault();let t=sessionStorage.getItem("projectOnEdit"),n=$("#updatePortfolioTitle").val(),i=$("#updatePortfolioDescription").val(),a=$("#updatePortfolioImage").val(),r=$("#updatePortfolioCategory").val(),s=$("#updatePortfolioPrice").val();$.ajax({url:`${e}/updatePortfolio/${t}`,type:"PATCH",data:{title:n,description:i,image:a,category:r,price:s},success:function(e){sessionStorage.removeItem("projectOnEdit"),$("#updatePortfolioForm").trigger("reset"),$("#updatePortfolioPage").hide(),o(),$("#projectPage").show(),$("html, body").animate({scrollTop:0},"fast")},error:function(){console.log("error: cannot call api")}})}),document.getElementById("updateMemberBtn").addEventListener("click",function(){$("#updateMemberBtn").hide(),document.getElementById("memberAccount").innerHTML='\n  <form id="editUserForm">\n    <div class="form-group row">\n      <label for="editUserForm__username" class="col-md-3">Username:</label>\n      <input type="text" class="form-control col-md-9" id="editUserForm__username">\n    </div>\n    <div class="form-group row">\n      <label for="editUserForm__email" class="col-md-3">Email:</label>\n      <input type="email" class="form-control col-md-9" id="editUserForm__email">\n    </div>\n    <div class="form-group row">\n      <label for="editUserForm__description" class="col-md-3">Description:</label>\n      <textarea type="text" class="form-control col-md-9" id="editUserForm__description" rows="4"></textarea>\n    </div>\n    <div class="form-group row">\n      <label for="editUserForm__location" class="col-md-3">Location:</label>\n      <input type="text" class="form-control col-md-9" id="editUserForm__location">\n    </div>\n    <div class="form-group row">\n      <label for="editUserForm__website" class="col-md-3">Website:</label>\n      <input type="text" class="form-control col-md-9" id="editUserForm__website">\n    </div>\n    <button class="btn btn-danger btn-font back-portfolio radius float-left mb-5">Cancel</button>\n    <button id="saveUserInfo" type="submit" class="float-right mb-5 btn btn-dark btn-font radius">Save</button>\n  </form>\n  ',document.getElementById("editUserForm").addEventListener("submit",i),function(){let t=sessionStorage.getItem("memberId");$.ajax({url:`${e}/myAccountInfo/${t}`,type:"GET",dataType:"json",success:function(e){$("#editUserForm__username").val(e.username),$("#editUserForm__email").val(e.email),$("#editUserForm__description").val(e.about),$("#editUserForm__website").val(e.website),$("#editUserForm__location").val(e.location)},error:function(e){console.log(e)}})}()}),document.getElementById("filterButton").addEventListener("click",function(){let t=JSON.parse($("#filterDropdown-byPrice").val()).min,o=JSON.parse($("#filterDropdown-byPrice").val()).max,n=$("#filterDropdown-byCategory").val();$.ajax({url:`${e}/filterPortfolios/${t}/${o}/${n}`,type:"GET",success:function(e){"Sorry, there is no artwork that matches your search!"===e?document.getElementById("artsDeck").innerHTML='\n          <div class="row mx-auto">\n          <h5 class="text-center mt-5 mb-5">Sorry, there is no artwork that matches your search!</h5>\n          </div>\n          ':r(e)},error:function(e){console.log("Error: "+e)}})})});